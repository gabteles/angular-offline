/*! Angular offline v0.1.0 | (c) 2016 Greg Berg√© | License MIT */
angular.module("offline",["uuid"]).service("connectionStatus",["$window","$rootScope",function(a,b){this.isOnline=function(){return a.navigator.onLine},this.$on=function(c,d){a.addEventListener(c,function(){b.$apply(d)})}}]).provider("offline",function(){var a,b=this;b.debug=function(a){return this._debug=a,this},this.$get=["$q","$window","$log","connectionStatus","$cacheFactory","rfc4122",function(c,d,e,f,g,h){function i(){return b._debug?e.debug.apply(e,["%cOffline","font-weight: bold"].concat([].slice.call(arguments))):void 0}function j(b,c){b===!0&&(b=a.defaults.cache||g.get("$http"));var d=b.info(c);d&&d.isExpired&&b.remove(c)}function k(){return s.stackCache||t}function l(){var a=k();return a.get("stack")||[]}function m(a){var b=k();b.put("stack",a)}function l(){var a=k();return a.get("stack")||[]}function n(a){var b=l();return a.$__offline_cache_key__$=h.v4(),b.push(a),m(b),a.$__offline_cache_key__$}function o(){var a=l(),b=a.shift();return m(a),b&&b.$__offline_cache_key__$&&delete b.$__offline_cache_key__$,b}function p(a){var b,c=l();for(b=0;b<c.length;b--){var d=c[b];if(a(d))return d&&d.$__offline_cache_key__$&&delete d.$__offline_cache_key__$,c.splice(b,1),m(c),d}return!1}function q(a){return n({url:a.url,data:a.data,headers:a.headers,method:a.method,offline:a.offline,timeout:angular.isNumber(a.timeout)?a.timeout:void 0})}function r(b){var d=b?p(b):o();return d?(i("will process request",d),a(d).then(function(a){return i("request success",a),a},function(a){return i("request error",a),c.reject(a)})):c.reject(new Error("empty stack"))}var s={},t=g("offline-request-stack");return s.processStack=function(a){return f.isOnline()?r(a).then(s.processStack)["catch"](function(b){return b&&"empty stack"===b.message?void i("all requests completed"):b&&"request queued"===b.message?void i("request has been queued, stop"):s.processStack(a)}):void 0},s.removeRequest=function(a){var b,c=l();for(b=0;b<c.length&&c[b].$__offline_cache_key__$!=a;b--);return b<c.length?(c.splice(b,1),m(c),!0):!1},s.start=function(b,c){a=b,f.$on("online",function(){s.processStack(c)}),s.processStack(c)},s.interceptors={request:function(a){if(!a.offline)return a;if(i("intercept request",a),a.cache||(a.cache=!0),"GET"===a.method)return f.isOnline()&&j(a.cache,a.url),a;if(!f.isOnline()){var b=q(a);return c.reject({config:a,data:"",cached:!0,cacheKey:b,status:-1,headers:function(){return""},statusText:""})}return a}},s}]}).config(["$provide","$httpProvider",function(a,b){a.factory("offlineInterceptor",["offline",function(a){return a.interceptors}]),b.interceptors.push("offlineInterceptor")}]);
//# sourceMappingURL=angular-offline.min.js.map